DROP TABLE IF EXISTS UserComments;
DROP TABLE IF EXISTS OrderContains;
DROP TABLE IF EXISTS Rating;
DROP TABLE IF EXISTS productImage;
DROP TABLE IF EXISTS Shipment;
DROP TABLE IF EXISTS Orders;
DROP TABLE IF EXISTS Product;
DROP TABLE IF EXISTS CreditCard;
DROP TABLE IF EXISTS Customer;

CREATE TABLE Customer(
	cid INT NOT NULL AUTO_INCREMENT,
    email VARCHAR(50) NOT NULL,
	fName VARCHAR(50) NOT NULL,
	lName VARCHAR(50) NOT NULL,
	address VARCHAR(100) NOT NULL, 
	cPassword VARCHAR(100) NOT NULL,
	phoneNum VARCHAR(20) NOT NULL,
	isAdmin INT NOT NULL,
	disabled INT NOT NULL,
	PRIMARY KEY (cid, email)
);

CREATE TABLE CreditCard (
	cardNum INT NOT NULL,
	cardExpired DATE NOT NULL,
	CVV INT NOT NULL,
	bAddress VARCHAR(100) NOT NULL,
    cid INT,
	PRIMARY KEY (cardNum),
	FOREIGN KEY (cid) REFERENCES Customer(cid) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE Product (
	pid INT NOT NULL AUTO_INCREMENT,
	pname VARCHAR(50) NOT NULL,
	price DECIMAL(5,2),
    description VARCHAR(1000),
    imageURL VARCHAR(500),
	category VARCHAR(20),
	PRIMARY KEY (pid)
);

CREATE TABLE Orders (
	oid INT NOT NULL AUTO_INCREMENT,
	purchasedDate DATETIME NOT NULL,
    cardNum INT NOT NULL,
    cid INT,
    trackingNum INT,
    PRIMARY KEY (oid),
	FOREIGN KEY (cardNum) REFERENCES CreditCard(cardNum) ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY (cid) REFERENCES Customer(cid) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE Shipment (
	trackingNum INT(20) NOT NULL,
	shipDate DATE NOT NULL,
	weight DOUBLE NOT NULL,
    cid INT NOT NULL,
    oid INT NOT NULL,
	PRIMARY KEY (trackingNum),
	FOREIGN KEY (cid) REFERENCES Customer(cid) ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY (oid) REFERENCES Orders(oid) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE productImage (
	imageID INT NOT NULL ,
	fileName VARCHAR(20) NOT NULL,
	fileType VARCHAR(50) NOT NULL,
    pid INT NOT NULL,
	PRIMARY KEY (imageID),
	FOREIGN KEY (pid) REFERENCES Product(pid) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE Rating (
	stars INT NOT NULL,   
    pid INT NOT NULL,
	PRIMARY KEY (stars),
	FOREIGN KEY (pid) REFERENCES Product(pid) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE OrderContains (
	quantity INT,
	price INT,
    oid INT NOT NULL,
    pid INT NOT NULL,
    PRIMARY KEY (oid, pid),
	FOREIGN KEY (oid) REFERENCES Orders(oid) ON UPDATE CASCADE ON DELETE CASCADE,
	FOREIGN KEY (pid) REFERENCES Product(pid) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE UserComments(
	commentsId INT NOT NULL AUTO_INCREMENT,
    pid INT NOT NULL,
	cid INT NOT NULL,
	content VARCHAR(1000) NOT NULL,
    
	PRIMARY KEY (commentsId, pid, cid),
    FOREIGN KEY (cid) REFERENCES Customer(cid) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (pid) REFERENCES Product(pid) ON UPDATE CASCADE ON DELETE CASCADE
);